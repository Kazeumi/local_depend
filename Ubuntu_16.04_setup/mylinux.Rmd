---
title: "My Linux Notes"
subtitle: "A Quick Reference"
author: "[Yongfu Liao](https://liao961120.github.io/)"
date: "`r format(Sys.Date(), '%B %d, %Y')`"
link-citations: yes
output:
  bookdown::html_document2:
    highlight: haddock
    css: /home/liao/local_depend/style_sheets/style.css
    df_print: kable
    toc: true
    toc_depth: 2
    toc_float:
        collapsed: false
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
	echo = TRUE,
	message = FALSE,
	warning = FALSE,
	comment = ">",
	dev='svg',
	fig.dim = c(5.5, 3.5)  # (width, height)
)
```

Common Techniques
========

## Copy Previous Command to file

```bash
cat ~/bash_pract/rmd-head.txt >> ~/bash_pract/doc.Rmd
echo "!!" >> ~/bash_pract/cmd_hist
```

Then the command appends literal `cat ~/bash_pract/rmd-head.txt >> ~/bash_pract/doc.Rmd` to the end of `cmd_hist`. Note that this **works only on the command line**, not shell scripts.


## Expansion with text

Download all web pages starting from `www.millionbook.net/wx/j/jingyong/sdxl/001.htm` to `www.millionbook.net/wx/j/jingyong/sdxl/041.htm`:

```bash
url=http://www.millionbook.net/wx/j/jingyong/sdxl/
wget "$url"{001..041}".htm"
```

Navigation
========

## File Manipulation

### Recursive Rename

Systematically rename multiple files by `for` loop.

```{bash, preprocess-dir, include=FALSE}
cd ~/bash_pract && rm -r dir
mkdir dir dir/dir2
touch dir/{01..03}-file.txt dir/README
```


Original files in the working dir:
```{bash}
ls ~/bash_pract/dir
```

Then, running the code below:
```{bash}
cd ~/bash_pract/dir

for i in {01..03}; do 
	mv $(echo $i'*') $(echo $i'.txt')
done

ls
```

## Soft Link

Syntax: `ln -s <target> <link-name>`

e.g.
```{bash}
cd ~/bash_pract
echo "Before:
$(ls -l)"

ln -s $(pwd)/dir/foo.txt $(pwd)/foo-sym

echo "
After:
$(ls -l)"
```

```{bash include=FALSE}
rm ~/bash_pract/foo-sym
```


Network
========


## Setup SSH

### Server Setup{-}
Install SSH Server (so be connected by a remote client):
```bash
sudo apt-get install openssh-server
```

Configure:
```bash
sudo gedit /etc/ssh/sshd_config
```

> Port 22
>
> PasswordAuthentication yes
>
> PermitRootLogin yes

Findout IP address locally: `hostname -I`


### Client Setup{-}

Access from remote via SSH:

Syntax: `ssh <server-user-account>@<ip>`

e.g.
```bash
ssh liao961120@192.168.2.110
```


Remote Control Via SSH
========

## Hardware Configuration

1. Fix floating IP
(Alternative: auto push IP address when turned on
https://superuser.com/questions/471253/ubuntu-how-to-run-a-terminal-command-on-boot)
2. Enable WakeOnLane(WOL) at BIOS: 
	1. `Power Management Setup` > `WOL: enabled`[^wol]
	2. `Power Management Setup` > `deep power off mode: disabled`[^poff]


[^wol]: There may be different names for WOL, such as 'Wake Up on Lan', 'Automatic Power Up', 'Resume by LAN', 'Power Up On PCI Device', 'PME Event Wake Up', etc.
[^poff]: This keeps the power for NIS to turn on the computer when receiving a signal from web.
[^utc]: Note the date time is in [Coordinated Universal Time (UTC) Standard](https://en.wikipedia.org/wiki/Coordinated_Universal_Time), so it's -8 hrs from the time in Taiwan.

## wakeonlan

wakeonlan -i <broadcast-ip> <MAC>

```bash
wakeonlan -i 192.168.2.255 44:87:fc:a1:0b:cc
wakeonlan -i $rm_ip_b $rm_MAC
```

## SSH login

ssh liao961120@<ip>

```bash
ssh liao961120@192.168.2.110
ssh $ssh_pc
```

## SSH logout & suspend computer

Use `sudo shutdown 0` to leave. Remember to enable `Power of Mode` in BIOS, so you can WOL to open the computer again.

## Variable Definition (in `~/.bashrc`)
```bash
rm_MAC="44:87:fc:a1:0b:cc"
rm_ip="192.168.2.110"
rm_ip_b=`bash ~/ip2ipb.sh $rm_ip`
ssh_pc="liao961120@$rm_ip"
```
