---
title: "R Markdown Features"
subtitle: "A Compact Reference"
author: "[Yongfu Liao](https://liao961120.github.io/)"
date: "`r format(Sys.Date(), '%B %e, %Y')`"
bibliography: /home/liao/local_depend/citation/neanderthals.bib
csl: /home/liao/local_depend/style_sheets/apa.csl
link-citations: yes
output:
  bookdown::html_document2:
    css: /home/liao/local_depend/style_sheets/style.css
    df_print: kable
    toc: true
    toc_depth: 2
    toc_float:
        collapsed: false
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
	echo = TRUE,
	message = FALSE,
	warning = FALSE,
	dev='svg',
	fig.dim = c(5.5, 3.5)  # (width, height)
)
str_date <- "`r format(Sys.Date(), '%B %e, %Y')`"
```

# yaml Setup {.tabset}

yaml metadata determines the output file format, looking, and any other additional customizing features of Rmarkdown files.  

## yaml of this Doc {-}

This is the complete yaml header of this document.

```{yaml}
---
title: "R Markdown Features"
subtitle: "A Compact Reference"
author: "[Yongfu Liao](https://liao961120.github.io/)"
date: "`r format(Sys.Date(), '%B %e, %Y')`" 
bibliography: /home/liao/local_depend/citation/neanderthals.bib
csl: /home/liao/local_depend/style_sheets/apa.csl
link-citations: yes
output:
  bookdown::html_document2:
    code_folding: show
    css: /home/liao/local_depend/style_sheets/style.css
    df_print: kable
    toc: true
    toc_depth: 2
    toc_float:
        collapsed: false
---
```

## HTML Output {-}

```{yaml}
output:
  html_document:
    includes:
        before_body: mathjax_bm.tex
    css: ../style_sheets/style.css
    df_print: kable
    code_folding: hide
    fig_width: 7
    fig_height: 6
    toc: true
    toc_depth: 4
    toc_float: true
```

## PDF Output {-}

You may need to attatch an additional `header.tex` and set `latex_engine` to `xelatex` for PDF documents containing multibite characters (e.g. Chinese). Read more about  [header.txt](#pdf-header).
```{yaml}
---
author: "廖永賦\\thanks{組別：3 ~~ 系級：心理三 ~~ 學號：B00000000}"
output:
  pdf_document:
    latex_engine: xelatex    
    includes:
        in_header: header.tex
documentclass: article
urlcolor: "blue"
fontsize: 12pt 
geometry: a5paper, headheight=0pt, margin=0.4in
---
```

Note that Latex only accepts fontsize of 10pt, 11pt, or 12pt. See [this](https://github.com/rstudio/rmarkdown/issues/878) for more detail.

## PDF Output2 {-}
This is the yaml header for `bookdown::pdf_document2` output. Using `bookdown` extensions have several advantages. Search 'bookdown' for details.
```{yaml}
---
author: "廖永賦\\thanks{組別：3 ~~ 系級：心理三 ~~ 學號：B00000000}"
output:
  bookdown::pdf_document2:
    number_sections: FALSE
    toc: False
    includes:
      in_header: header.tex
    latex_engine: xelatex
  bookdown::html_document2:
    number_sections: FALSE
    includes:
      before_body: mathjax_bm.tex
urlcolor: blue
always_allow_html: yes
---
```


## PDF: header.tex{- #pdf-header}

The code below is for generating PDF documents written in (Traditional) Chinese.

```{tex}
%加這個就可以設定字體
\usepackage{fontspec}
%使用xeCJK，其他的還有CJK或是xCJK
\usepackage{xeCJK}

\usepackage[fontsize=13pt]{scrextend}

%設定英文字型，不設的話就會使用預設的字型
\setmainfont{Calibri}

%設定中英文的字型
%字型的設定可以使用系統內的字型，而不用像以前一樣另外安裝
% AR PL KaitiM Big5 標楷體
% .PingFang TC
% Noto Sans CJK TC
\setCJKmainfont{AR PL KaitiM Big5}

%中文自動換行
\XeTeXlinebreaklocale "zh"

%文字的彈性間距
\XeTeXlinebreakskip = 0pt plus 1pt

%設定段落之間的距離
\setlength{\parskip}{0.15cm}

%設定行距
\linespread{1.2}

%suppress page number
%\pagenumbering{gobble}
```

## Bibliography {-}

```{yaml}
bibliography: ./citation/neanderthals.bib
csl: ./citation/apa.csl # APA style sheet
link-citations: yes
```

For citation syntax, read the section [Bibliography & Citations](#cite).

# knitr Parameters

## Root
```r
knitr::opts_knit$set(root.dir='..')
```
The root directory of the `.rmd` file you want to knit is set to the directory where the `.rmd` file is located by default. In the case above, I changed it to  the **directory that is parent to the default directory**. This is useful if you build websites with [R Markdown Websites](https://rmarkdown.rstudio.com/rmarkdown_websites.htm), since **R Markdown Websites** doesn't allow hierarchical website structure. By changing the root directory, you can more easly organize your project directory structure without violating the requirement of **R Markdown Websites**. This is especially true when you source a lot of Rscripts in the `.Rmd` files.

## Code Chunk & Figure Options
```r
library(svglite) 
knitr::opts_chunk$set(
	echo = FALSE, # No display code chunks
	message = FALSE,
	warning = FALSE,
	dev='svg', # or 'svglite' for multibite characters
	comment="",
	fig.dim = c(3.5, 3.5)  # (width, height)
)
options(digits = 2) # auto round to 2 decimals when printed
```

# Child Documents

It is possible to write R Markdown in separated files and combine them together before knitting to the output file. See [knitr documentation](https://yihui.name/knitr/) for more info.

## Usage

`main.Rmd`: 

    ---
    title: "This is Title"
    author: "Yongfu Liao"
    output: html_document
    ---

    `r ''````{r setup}
    options(knitr.duplicate.label = 'allow')
    ```

    `r ''````{r child="part1.Rmd"}
    ```

    `r ''````{r child="part2.Rmd"}
    ```

The skeleton file that combines several R Markdown files. Only this file is rendered, other R Markdown files will automatically be inserted in the knitting process.

To avoid code chunks having the same labels, set the option below in `setup` code chunk of `main.Rmd`.

```r
options(knitr.duplicate.label = 'allow')
```

# Conditional Compilation

```{r eval=FALSE}
if (knitr::is_html_output()) {
  ...
}

if (knitr::opts_knit$get('rmarkdown.pandoc.to') == "latex")
  ...
}
```


# Dynamic Variables

Include **R Code Chunk Variables** in the body of text. This can be a really useful feature for writing thesis or research paper: 

- No need to copy & paste the outcomes, such as the statistics. This greatly reduce the risk of error, and it also largely boosts efficiency.

- Automatically updates the results in the paper when the data are updated. This also boosts efficiency and, more importantly, increases the **reproducibility** of the research: you can be confident that the results come directly from the data (unless there are errors in the *code*, which can be 'seen', whereas **errors from copy-&-paste's are invisible**).

Below is a simple demonstration of this feature.

```{r}
tr1 <- rnorm(n=25, mean=1.1) #data of treatment1
tr2 <- rnorm(n=25, mean=0.9) #data of treatment2
ttest <- t.test(tr1, tr2, paired = T)
diff <- ttest[["estimate"]][["mean of the differences"]]
p_val <- ttest[["p.value"]]
```

1. The mean difference between the two groups is `r round(diff, 3)`.
    ```{latex}
    The mean difference between the two treatments is `r round(diff, 3)`.
    ```

2. The *p*-value of the paired t-test is `r round(p_val, 4)`, which is `r ifelse(p_val<=0.05, "", "not")` significant.
    ```{latex}
        The *p*-value of the paired t-test is `r round(p_val, 4)`, which is `r ifelse(p_val<=0.05, "", "not")` significant.
    ```

# Some $\LaTeX$ for PDF output

- `\pagenumbering{gobble}`
This LaTeX code suppress the page number.

- `\pagenumbering{arabic}`
'Turn on' page number closed by `\pagenumbering{gobble}`.

- `\newpage`: Start a new page

The 3 type of code can be useful in the situation below:

```tex
---
title: "A Title"
author: "Someone"
date: "`r str_date`"
---

... Some content in the first page (title page) ...

\pagenumbering{gobble} % Suppress page number on the title page
\newpage               % Start a new page

... Some content in the second page ...

\pagenumbering{arabic} % Revert suppression of page number
                       % Now, the page num starts with '2'
```


# $\LaTeX$ Math {.tabset}

## Passing Matrix Object {-}

### Setup {-}

Add `results='asis'` to r code chunk option.

````r
`r ''````{r results='asis', echo=FALSE}
library(mat2tex)
mt <- c(1,2)
"$A =" %_% xm(mt,0) %_%"_{2 \\times 1}$"
```
````

```{r echo=FALSE, results='asis'}
library(mat2tex)
mt <- c(1,2)
"$A =" %_% xm(mt,0) %_%"_{2 \\times 1}$"
```

### Include Matrix in Text {-}

````r
This is the variable `mt`,
`r ''````{r results='asis', echo=FALSE}
library(mat2tex)
mt <- matrix(1:4, 2,2)
"$A =" %_% xm(mt,0) %_%"^{-1}$"
```
, which is a matrix.
````

renders as:

<div class="success">
This is the variable `mt`,
```{r results='asis', echo=FALSE}
library(mat2tex)
mt <- matrix(1:4, 2,2)
"$A =" %_% xm(mt,0) %_%"^{-1}$"
```
, which is a matrix.
</div>

Check [here](http://markheckmann.github.io/mat2tex/){target=_blank""} for more information.

## kable {-}
```{r}
library(knitr)
library(dplyr)
iris_data <- head(iris) %>%
    select(Sepal.Length, Sepal.Width)

colnames(iris_data) <- c("$\\alpha$", "$\\frac{a}{b}$")
kable(iris_data, format = "markdown", align = "c")
```

## Plotting Expression {-}
```{r fig.height=3}
library(latex2exp)
library(ggplot2)
iris_data2 <- iris[c(1:3, 50:53, 100:103), ] %>%
    select(Sepal.Length, Sepal.Width, Species)

iris_data2 %>% ggplot() +
    geom_point(aes(x = Sepal.Length, 
                   y = Sepal.Width, 
                   color = Species)) +
    labs(x = TeX("Length($\\frac{kg}{cm^2}$)"),
         y = TeX("\\frac{a}{b}"))
```

# Display Code Chunk with Code Chunk

```{r include=F}
code <- htmltools::HTML("<code>`r ''`</code>")
```

Wrap the code chunk you want to display (without running the code inside) inside **four ticks**: 

`````rmd
````Rmd
`r code````{r}
Some R Code
```
````
`````

The code `r code` is for suppressing the execution of the r code chunk after it.

# Bibliographies & Citations{#cite} 

You can read the full documentation of [Bibliographies & Citations](https://rmarkdown.rstudio.com/authoring_bibliographies_and_citations.html){target="_blank"} at Rstudio.

## Citation syntax

### Classical Citation: **Author**, **year**, and **brackets** {-}
- `Some text [@citekey].`
    - Some text [@RN9].

### In-text Citation: **Author (year)** {-}
- `@citekey Some text`
    - @RN15 Some text 

- `@citekey [p. 20] Some text.`
    - @RN9 [p. 20] Some text.

### Year only: Suppress Author {-}
- `Some text [-@citekey].`
    - Some text [-@RN9]

### Two Citations {-}
- `Some text [@citekey1; @citekey2].`
    -  Some text [@RN9; @RN15].

- Prefix & Suffix
    - `Text [see @citekey1 pp.45; also, @citekey2 ch. 2].`
    -  Text [see @RN9 pp. 45; also, @RN15 ch. 2].

## Include `.bib` file in Reference {.tabset}

Rmarkdown requires specific formats of bibliographies. One of the most common one is `.bib`. A lot of people (including me) use Endnote to manage bibliographies. Read  [this](https://libguides.usask.ca/c.php?g=218034&p=1458583) to see how to generate `.bib` files from EndNote.

However, you can't control the format of the **citation key** generated by Endnote. Having a well-structured format of citation key greatly enhance efficiency, which can be done by using **[Zotero](https://www.zotero.org/)** and its extension **[Better BibTeX](https://retorque.re/zotero-better-bibtex/)**. I strongly recommend using this approach, since the learning curve isn't steep and it only hurts once. The payoff is a long-term efficiency boost.

Below are some syntax in Rmarkdown to control the display of reference in the document.

### Reference heading {-}

The body of cited reference in the `.bib` file will be shown under the header named Reference (it doesn't matter which **level** of heading you use).

```markdown
## Reference
```

### Specific Refs {-}
Include specific references that were **not cited** in the body of text.
```{pandoc}
---
nocite: |
  @item1, @item2
...
```

### All Refs {-}
Include **All references** in the body of text.
```{pandoc}
---
nocite: |
  @*
...
```



# Emphasis {.tabset}

## An Example {-}

````markdown
`r ''````{block2, type="success"}
| This is line 1, pragraph one. [**Red text**]{.red}. Text text text text.
| This is [line 2]{style="color:rgba(255, 0, 0, 1)"} of paragraph one. 

Paragraph two starts here.
```
````

```{block2, type="success"}
| This is line 1, pragraph one. [**Red text**]{.red}. Text text text text.
| This is [line 2]{style="color:rgba(255, 0, 0, 1)"} of paragraph one. 

Paragraph two starts here.
```

## Colored divs {-}

### Bootstrap Alert {-}

You can use bootstrap's default alert divs in Rmarkdown, defined with four classes:

1. alert alert-success
2. alert alert-warning
3. alert alert-info
4. alert alert-danger


````markdown
`r ''````{block, type="alert alert-success"}
Bootstrap-defined colored region
```
````

```{block, type="alert alert-success"}
Bootstrap-defined colored region
```

### Customized divs {-}

Alternative, you can define your own styled divs, as in my stylesheet[^css]:

There are 4 choices of classes,  

1. success
2. warning
3. info
4. error

````markdown
`r ''````{block, type="info"}
some text in the colored region
```
````

```{block, type="info"}
some text in the colored region
```

## Bootstrap Callouts {-}

Althougt it's "Bootstrap" callouts, it's not contained in default bootstrap theme. I defined it in my stylesheet.

There are 4 choices of classes,

1. bs-callout bs-callout-success
2. bs-callout bs-callout-warning
3. bs-callout bs-callout-info
4. bs-callout bs-callout-error

````markdown
`r ''````{block2, type="bs-callout bs-callout-warning"}
### Heading in Callout
**Calleout Text** texttexttexttexttexttext
```
````

```{block2, type="bs-callout bs-callout-warning"}
### Heading in Callout
**Calleout Text** texttexttexttexttexttext
```


## New Line {-}
```{markdown}
| Text of line 1
| Text of line 2

New paragraph
```

```{block2, type="alert alert-success"}
| Text of line 1
| Text of line 2

New paragraph
```

## Attach Attributes {-}
By using `[`text`]`, pandoc turns the text in the square brackets into the HTML `<span>` tag. HTML `class`, `id`, attributes specific to `<span>` can then be attached by using the curly braces.

### `class` {-}

Rmarkdown syntax allows attaching attributes (such as class, id, etc.) to certain elements by wrapping attributes into `{ ... }`.

Elements allowed attributes to be attach (by markdown syntax directly):

1. Section: Attributes are added next to **any level of heading**.
2. Link: `[Text](LINK){attributes}`
3. `span`: Text wrapped in `[`, `]`. e.g `[Text with class "red"]{.red}`.

```{markdown}
[**Red Bold text**]{.red}
```

```{block2, type="alert alert-success"}
[**Red Bold text**]{.red}
```

Note[^red].

### Other Attributes {-}
```{markdown}
Add color through [span style]{style="color:rgba(255, 0, 0, 1)"}
```

```{block2, type="alert alert-success"}
Add color through [span style]{style="color:rgba(255, 0, 0, 1)"}
```

# Footnotes with Paragraphs

Check [Pandoc](http://pandoc.org/MANUAL.html#footnotes){target="_blank"} for details.

```{markdown}
[^longnote]: Here's one with multiple blocks.

    Subsequent paragraphs are indented to show that they belong to the previous footnote. (JUST IGNORE ME, I AM Exteeeeeendiiiiiiing the text to show the effect of paragraph).

    In this way, multi-paragraph footnotes work like multi-paragraph list items.
```
- Read the output by clicking the superscript[^longnote].


# Shaped Images (HTML) {.tabset}

## Rounded Edge {-}
```{markdown}
![](../../local_depend/icons/libreoffice.ico){width=auto height="30%" .rounded}
```
![](/home/liao/local_depend/icons/libreoffice.ico){width=auto height="30%" .rounded}

### Boostrap {-}
```{markdown}
![](../../local_depend/icons/libreoffice.ico){width=auto height="30%" .img-rounded}
```
![Bootstrap Rounded](/home/liao/local_depend/icons/libreoffice.ico){width=auto height="30%" .img-rounded}


## Circle Image {-}
```{markdown}
![](../../local_depend/icons/libreoffice.ico){width=auto height="30%" .circle}
```
![This is figure Caption](/home/liao/local_depend/icons/libreoffice.ico){width=auto height="30%" .circle}

### Boostrap {-}
```{markdown}
![](../../local_depend/icons/libreoffice.ico){width=auto height="30%" .img-circle}
```
![Bootstrap Circle](/home/liao/local_depend/icons/libreoffice.ico){width=auto height="30%" .img-circle}

## Thumbnail {-}
```{markdown}
![](../../local_depend/icons/libreoffice.ico){width=auto height="30%" .img-thumbnail}
```
![Bootstrap Thumbnail](/home/liao/local_depend/icons/libreoffice.ico){width=auto height="30%" .img-thumbnail}

<!-- footnotes ---------------------------- -->
[^css]: Look at my [stylesheet](https://github.com/liao961120/local_depend/blob/master/style_sheets/style.css){target="_blank"} for syntax details.

[^longnote]: Here's one with multiple blocks.

    Subsequent paragraphs are indented to show that they belong to the previous footnote. (JUST IGNORE ME, I AM Exteeeeeendiiiiiiing the text to show the effect of paragraph).

    In this way, multi-paragraph footnotes work like multi-paragraph list items.

[^red]: `.red` is also a self-defined class in my stylesheet.
<!-- footnotes -------------------------- -->


<!-- syntax for Reference section --> 

# Figures

## Captions

Include `fig.cap='An Caption of the Plot'` in the code chunk option gives:
````r
`r ''````{r fig.cap='An Caption of the Plot'}
library(ggplot2)
ggplot(iris) +
    geom_point(aes(x = Sepal.Length,
                   y = Sepal.Width,
                   color = Species)
               )
```
````

```{r echo=FALSE, fig.cap='An Caption of the Plot'}
library(ggplot2)
ggplot(iris)+
    geom_point(aes(x=Sepal.Length, y=Sepal.Width, color=Species))
```


# Xaringan (remark.js Slide)

Xaringan is a HTML presentation output format of R Markdown. Xaringan doesn't support Pandoc markdown, but is very flexible and easy to use if having basic CSS knowledge. It also prints well on PDF (using Chrome or [decktape](https://github.com/astefanutti/decktape)). Read the [Chapter 7](https://bookdown.org/yihui/rmarkdown/xaringan.html) of *R Markdown Guide* for more details.

<iframe src="https://liao961120.github.io/slides/xaringan/index.html", width=400, height=301>
</iframe>  
[Slide Link](https://liao961120.github.io/slides/xaringan/index.html)



# Beamer Slide

<embed src="beamer.pdf" type="application/pdf" width="90%" height="420px">

Note: You can use (left & right) arrow keys to navigate through the slides page-by-page.

[Download This Slide](https://minhaskamal.github.io/DownGit/#/home?url=https://github.com/liao961120/local_depend/blob/master/GitHubPage/my_R_book/Rmarkdown_features/beamer/beamer.pdf)

# References
